<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Bill Perry" />


<title>Data analysis introduction</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Bill Perry</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="https://wlperry.github.io/index.html">Bill's Homepage</a>
</li>
<li>
  <a href="https://wlperry.github.io/2018_stats/index.html">Stats and R Homepage</a>
</li>
<li>
  <a href="about.html">About Bill</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data analysis introduction</h1>
<h4 class="author"><em>Bill Perry</em></h4>
<h4 class="date"><em>2018/03/14</em></h4>

</div>


<p>Designing a project from the ground up.</p>
<p>##Steps to consider</p>
<p>So the first thing to think about in my opinion is the workflow or dataflow:</p>
<ol style="list-style-type: decimal">
<li>What is the source and format of your data?
<ul>
<li>what are the variables and units and how will you name them</li>
<li>controlled vocabulary list</li>
<li>data structure in columns</li>
</ul></li>
<li>What is the final objective and use of your data and what output?
<ul>
<li>what is the most flexible output<br />
</li>
<li>graphs<br />
</li>
<li>summary statistics<br />
</li>
<li>statistical analyses<br />
</li>
</ul></li>
<li>What is the flow of data
<ul>
<li>source and update frequency<br />
</li>
<li>QA/QC and flagging of data<br />
</li>
<li>Transformations or calculations to be made<br />
</li>
<li>Final data output for use - note never write to original dataframe<br />
</li>
<li>Summary statistics<br />
</li>
<li>Graphs<br />
</li>
<li>Statistical Analyses<br />
</li>
<li>Reports with markdown<br />
</li>
<li>Annotate scripts and metadata<br />
</li>
</ul></li>
<li>Set up directory structure
<ul>
<li>R Project Directory
<ul>
<li>scripts</li>
<li>documents</li>
<li>data</li>
<li>figures / output</li>
<li>final_ized_data</li>
</ul></li>
</ul></li>
</ol>
<p>##Data Source Format ###Controlled vocabulary and units<br />
<br> Thinking about your data source first is important. Using a controlled vocabulary to reference the variables is critical and will save huge amounts of time when modifying the code later on. I find it helpful to have a meta data document with the vocabulary and the units for each term so that future users can figure out what your code means.<br />
<br> ###Variable names<br />
As part of controlled voabulary, the way you type the variable names is also important and also important to be consistent</p>
<ol style="list-style-type: decimal">
<li>snake case - looks_like_this - separated by _ and all lower case and often most popular<br />
</li>
<li>period separated - looks.like.this - separated by periods - may get confused with other commands<br />
</li>
<li>lower camel case - looksLikeThis - ever word is capitilized after the first - often harder to type with all the shift caps<br />
</li>
<li>upper camel case - LooksLikeThis - all words capitilized<br />
</li>
<li>all lower case - lookslikethis - I find it messy and hard to read<br />
<br></li>
</ol>
<p>the key is that you should have no spaces or special characters. If you do have spaces you use the back tick <strong>`</strong>on either side of the variable to call it.<br />
<br> Special characters are often coded differently in mac and pc computers and will cause more headaches than you have after St. Patricks Day.</p>
<p><br></p>
<p>###Transformations</p>
<p>Keeping a list of transformations can be helpful in coding and if it is in the meta data file, you can copy the transformations out of the document and if there are mistakes people can track it down fast.</p>
<p>###Data structure and format R uses a column format and all the data in a column has to be of the same type. You can, however, refernece data by row and column as in excel.<br />
<br> The most common data formats you will run into are:</p>
<ul>
<li>Numeric - can be double or integer but that is not as important<br />
</li>
<li>Character - text fields<br />
</li>
<li>Factors - displayed often as text but is as levels behind the scenes<br />
</li>
<li>Date - date format or POSIXLT
<ul>
<li>note this is in days since 1970-01-01 I believe<br />
</li>
</ul></li>
<li>Date time - date and time format together or POSIXCT
<ul>
<li>this is in seconds since 1970-01-01 00:00:00<br />
</li>
<li>this will be critical for many of you</li>
</ul></li>
</ul>
<p><strong>Note that if you mix formats within a column some of the variables will be converted to NA if say you have a column that is a character column which has mixed numbers and text and is then converted to numeric</strong></p>
<p>###Wide format original data</p>
<p>Typically when we enter data it is in <strong>wide format</strong> where an identifier is down the first column and the various variables are in separate columns. This is what is often easiest to enter into excel or wherever it is entered originally.</p>
<p>This format is often more difficult to work with in R and GGPlot so it is converted to <strong>long format</strong> where there is a column of identifiers, a column of variable names, and a column of values. The switch between these formats is often rather easy so it does not matter what format it is in.<br />
<br><br />
wide format:<br />
This is how you would likely enter it in excel<br />
Columns would be:</p>
<ul>
<li>individual<br />
</li>
<li>species<br />
</li>
<li>petal length<br />
</li>
<li>petal width<br />
</li>
<li>sepal lenght<br />
</li>
<li>sepal width<br />
<br></li>
</ul>
<p>long format:<br />
This would condense this format to fewer columns:</p>
<ul>
<li>individual<br />
</li>
<li>species<br />
</li>
<li>trait all in one colunm (petal length, petal width, sepal length , sepal width)<br />
</li>
<li>value (the values of each of the resprective traits)</li>
</ul>
<p>###Output<br />
I find it useful to maintain a read only file of the original data and never write to this file other than the original QA/QC flagging of the data if even then. I usually read from this file and save it to the finalized data folder where the data has been cleaned formatted and basic calculations done on it.</p>
<p>##Data Flow<br />
It is often very helpful prior to doing any code work to think about what the final output will look like and what the original data looks like and the steps between these two points.</p>
<p>##Directory structure</p>
<p>Having a consistent directory structure where code, data, and text is stored makes it easy to look at different directories and find what you are looking for. That is why I use the following structure. Choose what works for you and stick with it… please</p>
<blockquote>
<ul>
<li>r_projects<br />
- scripts<br />
- documents<br />
- data<br />
- figures or output<br />
- final_data</li>
</ul>
</blockquote>
<p>Using projects in R is super useful and you don’t have to worry about setting directories between a mac and windows machine and all the paths are relative in there when you reference data or output directories and is the same on windows and mac.</p>
<p>##File names From the site <a href="https://andrewbtran.github.io/NICAR/2018/workflow/docs/01-workflow_intro.html?utm_content=buffer858fd&amp;utm_medium=social&amp;utm_source=twitter.com&amp;utm_campaign=buffer">File organization and best practices</a> and <a href="https://kkulma.github.io/2018-03-18-Prime-Hints-for-Running-a-data-project-in-R/">Prime Hints</a> naming files has many good practices. Of these the main theme is:</p>
<ol style="list-style-type: decimal">
<li>Use a consistent naming theme</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>use date_term1_term2.xxx<br />
</li>
<li>no spaces or other fancy characters<br />
</li>
<li>make the names human understandable<br />
</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li>Use natural ordering of files<br />
</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>use date at front or somewhere so you know the version<br />
</li>
<li>use logical ordering like 01_ 02_ 03_<br />
</li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li>Avoid things like<br />
</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>final thesis proposal.docx - I deal with many students and this is not helpful</li>
</ol>
<p>##Annotations and metadata files</p>
<p><strong>For the love of all that is good</strong> - be sure to annotate you code using the <code>#</code> and whatever text helps describe the process you are doing - it will make the code easier to read and evaluate later when you are trying to figure out something really fast. You can also use it to search for code snippets as you are going along.</p>
<p>Metadata files that document what you are doing and why and what the various conversions and statistical transformations are can be of great use later on as well. It is often challenging to figure out what the units are in for various variables or what they actually mean.</p>
<p>##RStudio Specifics<br />
###Outline your code to navigate<br />
You can write a comment <code>#</code> and then follow it with <code>text</code> and then 4 dashes <code>----</code> or <code>####</code> and it will create a note in the outline view</p>
<p>###Comment your code<br />
You should use comments <code>#</code> with text behind it to annotate the purpose of what your are doing and what is happening in the code chunk below.</p>
<p>##Installing R So lets start installing R and R studio<br />
R is its own program and can be retrieved from <a href="https://cran.r-project.org/">R Cran</a><br />
<br><br />
R Studio is a program that makes the interface and usability of R easier in my opinion and can be retrieved here <a href="https://www.rstudio.com/products/rstudio/download/">R Studio</a></p>
<p><br> When you get these installed we can load up R studio and look at the interface.</p>
<p>###R interface Start R studio and you should see: <img src="images/setup_1.png" alt="r interface" /></p>
<p>###Project Setup Now to set up a new project - this is if the directory does not exist Click: 1. File 2. New Project <img src="images/setup_2.png" alt="Project set up" /></p>
<p>You can select <code>New Directory</code> or you can select existing directory - lets say you choose new directory <img src="images/setup_3.png" alt="File New Project New Directory" /></p>
<p>For now you are doing a <code>New Project</code>. We will talk about Github at a later date</p>
<div class="figure">
<img src="images/setup_4.png" alt="Direcotry Name for Porject" />
<p class="caption">Direcotry Name for Porject</p>
</div>
<p>Interface changes only slightly - look in the upper right<br />
<img src="images/setup_5.png" alt="What has changed" /></p>
<p>###Scripts<br />
Now we can create a new script</p>
<ol style="list-style-type: decimal">
<li>File</li>
<li>New file</li>
<li>R Script</li>
</ol>
<div class="figure">
<img src="images/setup_6.png" alt="New Script" />
<p class="caption">New Script</p>
</div>
<p>Now the interface looks like <img src="images/setup_7.png" alt="Scriptst" /></p>
<p>###Install Libraries The key to R in my opinion is to install libraries. We will practice with one and your homework is to install the others.</p>
<p>You will type:<br />
<code>#install libraires ----</code><br />
<code>install.packages(&quot;tidyverse&quot;)</code></p>
<p><code>#load libraries----</code><br />
<code>library(tidyverse)</code></p>
<p>Then after each you will hit command or control return and it will run the command or you can click run.</p>
<p>Here is a list of packages I have found useful</p>
<p><code>tidyverse</code><br />
<code>lubridate</code><br />
<code>readxl</code><br />
<code>scales</code><br />
<code>patchwork</code><br />
<code>janitor</code><br />
<code>skimr</code></p>
<p>others not loaded each time:<br />
<code>reshape2</code></p>
<p>other specialties<br />
<code>devtools</code></p>
<p>A different type of installation for the USGS data<br />
<code>install_github(&quot;USGS-R/dataRetrieval&quot;)</code><br />
<code>install.packages(&quot;dataRetrieval&quot;)</code><br />
<code>install.packages(&quot;dataRetrieval&quot;,</code><br />
<code>repos=c(&quot;http://owi.usgs.gov/R&quot;,</code><br />
<code>getOption(&quot;repos&quot;)))</code></p>
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-88373117-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-88373117-4');
</script>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
