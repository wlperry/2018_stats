---
title: "GGPlot introduction"
author: "Bill Perry"
date: "2018/03/14"
output:
  # css: stats.css
  html_document:
   toc: TRUE
   toc_float: TRUE
   number_sections:  FALSE
   
---
## Load Libraries    
```{r}
# load the libraries each time you restart R
library(tidyverse)
library(lubridate)
library(readxl)
library(scales)
library(skimr)
library(janitor)
library(patchwork)
```


## Read in the file
```{r 03_read_data}
iris.df <- read_csv("data/iris.csv", guess_max = 10000)
```


## Plot data       
So below I have added in data=, y= and x= but they are not really necessary
```{r}
ggplot(data=iris.df, aes(x=Petal.Length, y=Petal.Width)) +	
  geom_point()	
```

This creates the same image. You are just putting the aestetics in the geometry section         
```{r}
#' This is the same as the above plot but puts the aesthetics in the geometry
ggplot(data=iris.df) +	
  geom_point(aes(x=Petal.Length, y=Petal.Width))	

```

 
What is the advantage of doing the above method? 
How could you add a set of points for `Sepal.Length` and `Sepal.Width` to the 
existing graph:    

```{r}
ggplot(data=iris.df) +	
  geom_point(aes(x=Petal.Length, y=Petal.Width))	
```

## Colors of points      
Note in the above graph all of the points are black although we know there are three species. We can do two things with this. We can add a color to the graph

```{r}
ggplot(data=iris.df, aes(x=Petal.Length, y=Petal.Width)) +	
  geom_point(color="blue")	
```

This creates a color for all of the points. We can however map the colors to the species to make colors vary for each `Species`

```{r}
ggplot(data=iris.df, aes(x=Petal.Length, y=Petal.Width, color=Species)) +	
  geom_point()	

```

## ize of points   

We could also just make the point sizes all just larger by entering the size parameter outside of the aesthetics parentheses.
```{r}
ggplot(data=iris.df, aes(x=Petal.Length, y=Petal.Width, color=Species)) +	
  geom_point(size=3)	

```


We can do the same thing with size of data points based on `Petal.Width` or other continuous variable.   

```{r}
ggplot(data=iris.df, aes(x=Petal.Length, y=Petal.Width, color=Species)) +	
  geom_point(size=4)	

```



## Shapes of Points    
We could also map the type of point shape to the species   

```{r}
ggplot(data=iris.df, aes(x=Petal.Length, y=Petal.Width, shape=Species)) +
  geom_point(size=4)
```

The shapes of the various options are:   
![Shapes of various points.](images/point_shapes.png)


The types of lines you can have are:    
![Types of lines.](images/line_types.png)

## Facetting 
Now the cool thing to be able to look at data is to be able to facet or look at subplots of all of the data at once

```{r}

ggplot(data=iris.df) +
  geom_point(aes(x=Petal.Length, y=Petal.Width, shape=Species, color=Species)) +
  facet_grid(. ~ Species)
  


```

or

```{r}
ggplot(data=iris.df) +
  geom_point(aes(x=Petal.Length, y=Petal.Width, shape=Species, color=Species)) +
  facet_grid(Species ~ ., scales = "free") 
```



Facet wrap is slightly different and will allow you to have all free scales and facet by species
```{r}
ggplot(data=iris.df) +
  geom_point(aes(x=Petal.Length, y=Petal.Width, shape=Species, color=Species)) +
  facet_wrap("Species", scales = "free")
```

## Adding Titles      
Now to add in some of the basic things you might want to have on there to make it look nicer. We will work more on this later to get it publication quality but this is a start.  


```{r}
ggplot(data=iris.df, aes(x=Petal.Length, y=Petal.Width, shape=Species, color=Species)) +
  geom_point() +
  ggtitle("Petal Shape") +
  labs(x="Petal Length", y="Petal Width")
  # we will get into themes but this will center the title
  # theme(plot.title = element_text(hjust = 0.5))
```

## Time series plots    
Now its time to work with data like we usually use in data on buoys and sensors - time series plots. These can be a bit trickier but tidyverse and the scales package come into their own now.
###Read in the data
```{r}
streams.df <- read_csv("data/streams_q_gage_no3.csv", guess_max = 10000)
# Guess max extends the deault guessing of column type for a longer time than the 
# default if there are mssing values down the column

glimpse(streams.df)
```

## Basic time series plot
```{r}
ggplot(streams.df, aes(datetime, no3_mgl, color=site)) +
  geom_point()
```

## Scales - time series
```{r}
ggplot(streams.df, aes(datetime, no3_mgl, color=site)) +
  geom_point() +
  scale_y_continuous()+ #expand=c(0,0), breaks=c(0,30,60)
     scale_x_datetime(date_breaks = "1 month",
                  limits = ymd_hms(c('2017-01-01 00:00:00','2017-12-31 00:00:00')),
                  labels=date_format("%Y-%b-%d"), expand=c(0,0))
```


## Themes
```{r before last}
ggplot(streams.df, aes(datetime, no3_mgl, color=site)) +
  geom_point() +
  scale_y_continuous()+ #expand=c(0,0), breaks=c(0,30,60)
     scale_x_datetime(date_breaks = "1 month",
                  limits = ymd_hms(c('2017-01-01 00:00:00','2017-12-31 00:00:00')),
                  labels=date_format("%Y-%b-%d"), expand=c(0,0)) +
  theme_bw()
```

## Theme - adjust text
```{r last code}
ggplot(streams.df, aes(datetime, no3_mgl, color=site)) +
  geom_point() +
  scale_y_continuous()+ #expand=c(0,0), breaks=c(0,30,60)
     scale_x_datetime(date_breaks = "1 month",
                  limits = ymd_hms(c('2017-01-01 00:00:00','2017-12-31 00:00:00')),
                  labels=date_format("%Y-%b-%d"), expand=c(0,0)) +
  theme(
       # LABLES APPEARANCE
       axis.title.x=element_text(size=12, face="bold"),
       axis.title.y=element_text(size=12, face="bold"),
       axis.text.x = element_text(size=10, face="bold", angle=45, hjust=1),
       axis.text.y = element_text(size=10, face="bold"))
```


## Final time series plot
So lets make all the changes to the graph that we might want to do

```{r}
ggplot(streams.df, aes(datetime, no3_mgl, color=site)) +
  geom_point() +
  scale_y_continuous()+ #expand=c(0,0), breaks=c(0,30,60)
     scale_x_datetime(date_breaks = "1 month",
                  limits = ymd_hms(c('2017-01-01 00:00:00','2017-12-31 00:00:00')),
                  labels=date_format("%Y-%b-%d"), expand=c(0,0)) +
  scale_color_manual (name="Sites",
                      labels=c("Indian Cr.", "Vermillion Cr."),
                      values=c("red","darkblue")) +
  labs(x = "", y = "Nitrate NO3 (mg L^-1") +
theme(
    # LABLES APPEARANCE
    axis.title.x=element_text(size=12, face="bold"),
    axis.title.y=element_text(size=12, face="bold"),
    axis.text.x = element_text(size=10, face="bold", angle=45, hjust=1),
    axis.text.y = element_text(size=10, face="bold"),
 # plot.title = element_text(hjust = 0.5, colour="black", size=22, face="bold"),
 # LEGEND
 # legend.position="none",
 # LEGEND TEXT
 legend.text = element_text(colour="black", size = 12, face = "bold"),
 # LEGEND TITLE
 legend.title = element_text(colour="black", size=14, face="bold"),
 # LEGEND POSITION AND JUSTIFICATION
 # legend.justification=c(0.1,1),
 # legend.position=c(0.02,.99),
 # PLOT COLORS
 # REMOVE BOX BEHIND LEGEND SYMBOLS
 # REMOVE LEGEND BOX
  legend.key = element_rect(fill = "transparent", colour = "transparent"),
 # REMOVE LEGEND BOX
  legend.background = element_rect(fill = "transparent", colour = "transparent"),
 # #REMOVE PLOT FILL AND GRIDS
 # panel.background=element_rect(fill = "transparent", colour = "transparent"),
 # # removes the window background
 # plot.background=element_rect(fill="transparent",colour=NA),
 # # removes the grid lines
 # panel.grid.major = element_blank(),
 # panel.grid.minor = element_blank(),
 # ADD AXES LINES AND SIZE
 axis.line.x = element_line(color="black", size = 0.3),
 axis.line.y = element_line(color="black", size = 0.3),
 # ADD PLOT BOX
 panel.border = element_rect(colour = "black", fill=NA, size=0.3))
```




   
   

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-88373117-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-88373117-4');
</script>
