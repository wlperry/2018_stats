<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Bill Perry" />


<title>Data Modification</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Bill Perry</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="https://wlperry.github.io/index.html">Bill's Homepage</a>
</li>
<li>
  <a href="https://wlperry.github.io/2018_stats/index.html">Stats and R Homepage</a>
</li>
<li>
  <a href="about.html">About Bill</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data Modification</h1>
<h4 class="author"><em>Bill Perry</em></h4>
<h4 class="date"><em>2018/03/14</em></h4>

</div>


<div id="dataframe-wide-to-long-and-long-to-wide" class="section level2">
<h2>Dataframe wide to long and long to wide</h2>
<p>I seem to always have to go back and read how to do this over and over so I am trying to get it down here so I can use this as a reference and others might find it helpful.</p>
<p>Wide format is how you would usually enter data in excel with treatment down the left had side or some other category and variables for that treatment along the top row. This if a fine way to enter data but is not often that useful in R and you need to switch it to long format. I will post examples soon</p>
<p>##Load libraries We will read in the main files and load the libraries as we have worked with so far. I will do the iris.df first and then go to others that may be more complicated.</p>
<pre class="r"><code># One new package for summary stats
#install.packages(&quot;psych&quot;)

# load the libraries each time you restart R
library(tidyverse)
library(lubridate)
library(scales)
library(skimr)
library(janitor)
library(patchwork)
library(reshape2)
library(kableExtra)</code></pre>
<p>##Read in file<br />
So a lot of us have to deal with grades but you will get the idea of how this works with a simple dataframe and then we can go on.</p>
<pre class="r"><code># read in the file
grades.df &lt;- read_csv(&quot;data/grades.csv&quot;) %&gt;%
  clean_names() %&gt;%
  remove_empty(c(&quot;rows&quot;, &quot;cols&quot;)) 

glimpse(grades.df)</code></pre>
<pre><code>## Observations: 99
## Variables: 7
## $ student_id &lt;chr&gt; &quot;john_doe_1&quot;, &quot;john_doe_2&quot;, &quot;john_doe_3&quot;, &quot;john_doe_4…
## $ hw_1       &lt;dbl&gt; 25.14, 25.14, 25.14, 25.14, 24.81, 24.81, 24.81, 24.7…
## $ hw_2       &lt;dbl&gt; 28.87, 28.87, 28.87, 28.85, 28.85, 28.84, 28.84, 28.8…
## $ hw_3       &lt;dbl&gt; 25.96, 25.96, 25.96, 25.96, 25.96, 25.96, 25.96, 25.9…
## $ hw_4       &lt;dbl&gt; 23.94, 23.94, 23.94, 23.94, 23.94, 23.94, 23.94, 23.9…
## $ hw_5       &lt;dbl&gt; 24.32, 24.32, 24.32, 24.32, 24.32, 24.32, 24.32, 24.2…
## $ hw_6       &lt;dbl&gt; 31.18, 31.18, 31.09, 31.06, 31.06, 31.03, 31.00, 31.0…</code></pre>
<p>##Wide format file</p>
<p>This file is something that we might hae entered the grades in and it is something we are used to doing in excel. That is not bad but it limits what we can do fast with the file.</p>
<pre class="r"><code># head(grades.df) %&gt;% 
#   kable(&quot;html&quot;) %&gt;%
#   kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;))</code></pre>
<div id="graphing-in-wide-format" class="section level3">
<h3>Graphing in wide format</h3>
<p>So we want to make histograms of the grades and see what they are doing in each of the homeworks. We would have to make a plot for each of them. Ugggh… This is doable though and fine but not tidy and easy.</p>
<pre class="r"><code>grades.df %&gt;% ggplot(aes(hw_1)) +
  geom_histogram(binwidth = 5 ) + 
  scale_x_continuous(breaks=seq(0,100,5)) +
  labs(x=&quot;Points&quot;, y=&quot;Number of Students&quot;)</code></pre>
<p><img src="05_dataframe_widelong_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>##Convert to <em>long</em> format<br />
Note that it is a bit differnet now. you hae students going down the left, item which has each homework for each student and the grades on the right. Studnet 1 is listed 6 times for each of his 6 homeworks. Why on earth would we do this!!!!!?????</p>
<pre class="r"><code>grades_long.df &lt;- grades.df %&gt;% 
  gather(item, grade, -student_id) %&gt;%
  mutate(item = as.factor(item)) %&gt;%
  arrange(student_id, item)


head(grades_long.df, n=10) %&gt;% 
  kable(&quot;html&quot;) %&gt;%
  kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
student_id
</th>
<th style="text-align:left;">
item
</th>
<th style="text-align:right;">
grade
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
john_doe_1
</td>
<td style="text-align:left;">
hw_1
</td>
<td style="text-align:right;">
25.14
</td>
</tr>
<tr>
<td style="text-align:left;">
john_doe_1
</td>
<td style="text-align:left;">
hw_2
</td>
<td style="text-align:right;">
28.87
</td>
</tr>
<tr>
<td style="text-align:left;">
john_doe_1
</td>
<td style="text-align:left;">
hw_3
</td>
<td style="text-align:right;">
25.96
</td>
</tr>
<tr>
<td style="text-align:left;">
john_doe_1
</td>
<td style="text-align:left;">
hw_4
</td>
<td style="text-align:right;">
23.94
</td>
</tr>
<tr>
<td style="text-align:left;">
john_doe_1
</td>
<td style="text-align:left;">
hw_5
</td>
<td style="text-align:right;">
24.32
</td>
</tr>
<tr>
<td style="text-align:left;">
john_doe_1
</td>
<td style="text-align:left;">
hw_6
</td>
<td style="text-align:right;">
31.18
</td>
</tr>
<tr>
<td style="text-align:left;">
john_doe_10
</td>
<td style="text-align:left;">
hw_1
</td>
<td style="text-align:right;">
23.97
</td>
</tr>
<tr>
<td style="text-align:left;">
john_doe_10
</td>
<td style="text-align:left;">
hw_2
</td>
<td style="text-align:right;">
28.64
</td>
</tr>
<tr>
<td style="text-align:left;">
john_doe_10
</td>
<td style="text-align:left;">
hw_3
</td>
<td style="text-align:right;">
25.96
</td>
</tr>
<tr>
<td style="text-align:left;">
john_doe_10
</td>
<td style="text-align:left;">
hw_4
</td>
<td style="text-align:right;">
23.94
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="why-long-format" class="section level2">
<h2>Why <em>long</em> format</h2>
<p>Well the reason you need this format is for several types of analyses and it also makes graphing and working with the data easier. Here is an example to show all the graphs for eah homework in a quick way…<br />
<br><br />
Remember we can use filter and select to do things in ggplot with before the plot command too…</p>
<p>##Data <a href="https://wlperry.github.io/data/grades.csv">Fake Grades</a></p>
<pre class="r"><code>grades_long.df %&gt;% 
  ggplot(aes(grade)) +
  geom_histogram(binwidth = 5 ) + 
  scale_x_continuous(breaks=seq(0,100,10)) +
  labs(x=&quot;Points&quot;, y=&quot;Number of Students&quot;) +
  facet_wrap(&quot;item&quot;,  scales = &quot;free&quot;)</code></pre>
<p><img src="05_dataframe_widelong_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Lets say you only wanted to show homework 1 - 3 in the above plot. How could you do this easily. Note that the <code>|</code> is or so we can choose homework 1 or 2 or 3.</p>
<pre class="r"><code>grades_long.df %&gt;% filter(item == &quot;hw_1&quot; |
                            item == &quot;hw_2&quot; |
                          item == &quot;hw_3&quot;) %&gt;%
  ggplot(aes(grade)) +
  geom_histogram(binwidth = 5 ) + 
  scale_x_continuous(breaks=seq(0,100,10)) +
  labs(x=&quot;Points&quot;, y=&quot;Number of Students&quot;) +
  facet_wrap(&quot;item&quot;,  scales = &quot;free&quot;)</code></pre>
<p><img src="05_dataframe_widelong_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>##Long to wide format - Spread So we can convert this back to wide format just as easily. In doing this you just need to indicate what the category is to put along the top and the measure.</p>
<pre class="r"><code>grades_wide.df &lt;- grades_long.df %&gt;% 
  spread(item, grade)

glimpse(grades_wide.df)</code></pre>
<pre><code>## Observations: 99
## Variables: 7
## $ student_id &lt;chr&gt; &quot;john_doe_1&quot;, &quot;john_doe_10&quot;, &quot;john_doe_11&quot;, &quot;john_doe…
## $ hw_1       &lt;dbl&gt; 25.14, 23.97, 23.81, 23.81, 23.81, 23.56, 23.47, 23.3…
## $ hw_2       &lt;dbl&gt; 28.87, 28.64, 28.51, 28.51, 28.49, 28.46, 28.44, 28.4…
## $ hw_3       &lt;dbl&gt; 25.96, 25.96, 25.96, 25.96, 25.96, 25.96, 25.96, 25.9…
## $ hw_4       &lt;dbl&gt; 23.94, 23.94, 23.94, 23.94, 23.94, 23.94, 23.94, 23.8…
## $ hw_5       &lt;dbl&gt; 24.32, 24.28, 24.27, 24.26, 24.26, 24.26, 24.25, 24.2…
## $ hw_6       &lt;dbl&gt; 31.18, 30.91, 30.88, 30.86, 30.85, 30.85, 30.80, 30.7…</code></pre>
<p>##Examples using iris.df<br />
So above were examples using the grades dataframe which is totally made up. Below it is done using the iris dataframe that we have played with before.</p>
<p>###Janitor importer So often when we read in a file especially from excel.<br />
This will</p>
<ul>
<li>convert all names to lower snake case</li>
<li>remove all special characters</li>
<li>remove empty columns and rows that plague excel sheets</li>
</ul>
<pre class="r"><code># read in the file
iris.df &lt;- read_csv(&quot;data/iris.csv&quot;) %&gt;%
  clean_names() %&gt;%
  remove_empty(c(&quot;rows&quot;, &quot;cols&quot;)) 

glimpse(iris.df)</code></pre>
<pre><code>## Observations: 150
## Variables: 5
## $ sepal_length &lt;dbl&gt; 5.1, NA, 4.7, 4.6, 5.0, 5.4, 4.6, 5.0, 4.4, 4.9, 5.…
## $ sepal_width  &lt;dbl&gt; 3.5, 3.0, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1, 3…
## $ petal_length &lt;dbl&gt; 1.4, 1.4, 1.3, 1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5, 1…
## $ petal_width  &lt;dbl&gt; 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0…
## $ species      &lt;chr&gt; &quot;setosa&quot;, &quot;setosa&quot;, &quot;setosa&quot;, &quot;setosa&quot;, &quot;setosa&quot;, &quot;…</code></pre>
<p>Because for some reason there is no variable to identify the individual we have to create one. Without this there is no way to go from long to wide format as R does not know what values belong to which species if there are no unique identifiers.</p>
<pre class="r"><code># this will add an index to the dataframe so you know what individual is which
iris.df &lt;- iris.df %&gt;% mutate(individual = row_number())</code></pre>
<p>###Iris to Long format<br />
So in this section you indicate that you want variables for trait which is along the top and for some measure or response variable. You then select the columns that will go down the left for each individual and you do this with the - sign followed by the variable.</p>
<pre class="r"><code>iris_long.df &lt;- iris.df %&gt;% gather(trait, measure, -species, - individual)</code></pre>
<div id="iris-spread-long-to-wide-format" class="section level3">
<h3>Iris Spread long to wide format</h3>
<p>Again, here you would select the column that will become the header or variable name and the response variable to go under that and the other variables will stay along the left column.</p>
<pre class="r"><code>iris_wide.df &lt;- iris_long.df %&gt;% 
  spread(trait, measure)</code></pre>
<p>##Unite and Separate a variable<br />
So sometimes we want to make a variable out of two variables for grouping or graphing. This can be done easily using the unite command. Separate is the opposite.</p>
<p>###Unite This will create a variable that is listed first in quotes from the variables listed after it. So here we are going to make an individual and species variable from the two separate variables and will also separate these using the &quot;_&quot; separator which makes it easy to break that apart.</p>
<pre class="r"><code>iris_unite.df &lt;- iris.df %&gt;% 
  unite(&quot;ind_species&quot;, individual, species, sep=&quot;_&quot;)</code></pre>
<p>###Separate<br />
We can also separate a variable with a separator in it into its respective parts. First we indicate the variable to split and then the variables we what to break it into in a concatenated lists indicated by <code>c(&quot;1&quot;, &quot;2&quot;)</code></p>
<pre class="r"><code>iris_spread.df &lt;- iris_unite.df %&gt;% 
  separate(ind_species, into=c(&quot;individual&quot;, &quot;species&quot;), sep=&quot;_&quot;)</code></pre>
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-88373117-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-88373117-4');
</script>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
